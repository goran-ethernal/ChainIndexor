# {{.Name}} Indexer

Auto-generated indexer for {{.Name}} events.

## Events
{{range .Events}}
- {{"`"}}{{.Raw}}{{"`"}}
{{- end}}

## Database Schema
{{- range .Events}}

### {{TableName .Name}}

| Column | Type | Description |
| ------ | ---- | ----------- |
| id | INTEGER | Primary key |
| block_number | INTEGER | Block number |
| block_hash | TEXT | Block hash |
| tx_hash | TEXT | Transaction hash |
| tx_index | INTEGER | Transaction index |
| log_index | INTEGER | Log index |
{{- range .Params}}
| {{DBFieldName .Name}} | {{DBTypeName .Type}} | {{.Name}} ({{.Type}}) |
{{- end}}

**Indexes:**

- {{"`"}}block_number{{"`"}}
- {{"`"}}tx_hash{{"`"}}
{{- range .Params}}
{{- if or (eq .Type "address") .Indexed}}
- {{"`"}}{{DBFieldName .Name}}{{"`"}}
{{- end}}
{{- end}}
{{- end}}

## Usage

### 1. Add to your config.yaml

{{"`"}}{{"`"}}{{"`"}}yaml
indexers:
  - name: "{{.Name}}Indexer"
    start_block: 0
    db:
      path: "./data/{{ToSnakeCase .Name}}.sqlite"
    contracts:
      - address: "0xYourContractAddress"
        events:
{{- range .Events}}
          - "{{.CanonicalSignature}}"
{{- end}}
{{"`"}}{{"`"}}{{"`"}}

### 2. Import in your main.go

{{"`"}}{{"`"}}{{"`"}}go
import "yourproject/indexers/{{.Package}}"

indexer, err := {{.Package}}.New{{.Name}}Indexer(cfg, log)
if err != nil {
    log.Fatal(err)
}

orchestrator.RegisterIndexer(indexer)
{{"`"}}{{"`"}}{{"`"}}

### 3. Run your indexer

{{"`"}}{{"`"}}{{"`"}}bash
go run ./cmd/indexer
{{"`"}}{{"`"}}{{"`"}}

## REST API Endpoints

Once you implement the {{"`"}}Queryable{{"`"}} interface and enable the API in your configuration, the following endpoints become available:

### GET /indexers

List all registered indexers.

{{"`"}}{{"`"}}{{"`"}}bash
curl http://localhost:8080/indexers
{{"`"}}{{"`"}}{{"`"}}

### GET /indexers/{{.Package}}/events

Query {{.Name}} events with filtering and pagination.

**Query Parameters:**
- {{"`"}}limit{{"`"}} (int, default: 100, max: 1000)
- {{"`"}}offset{{"`"}} (int, default: 0)
- {{"`"}}from_block{{"`"}} (uint64, optional)
- {{"`"}}to_block{{"`"}} (uint64, optional)
- {{"`"}}address{{"`"}} (string, optional)
- {{"`"}}event_type{{"`"}} (string, optional)

**Example:**

{{"`"}}{{"`"}}{{"`"}}bash
# Get latest 50 events
curl "http://localhost:8080/indexers/{{.Package}}/events?limit=50"

# Query with filters
curl "http://localhost:8080/indexers/{{.Package}}/events?event_type=Transfer&limit=50"
{{"`"}}{{"`"}}{{"`"}}

### GET /indexers/{{.Package}}/stats

Get indexer statistics including total events and event counts by type.

{{"`"}}{{"`"}}{{"`"}}bash
curl "http://localhost:8080/indexers/{{.Package}}/stats"
{{"`"}}{{"`"}}{{"`"}}

### GET /indexers/{{.Package}}/events/timeseries

Get time-series aggregated event data for analytics.

**Query Parameters:**
- {{"`"}}interval{{"`"}} (string, optional: "hour", "day", "week", default: "day")
- {{"`"}}event_type{{"`"}} (string, optional)
- {{"`"}}from_block{{"`"}} (uint64, optional)
- {{"`"}}to_block{{"`"}} (uint64, optional)

{{"`"}}{{"`"}}{{"`"}}bash
curl "http://localhost:8080/indexers/{{.Package}}/events/timeseries?interval=day"
{{"`"}}{{"`"}}{{"`"}}

### GET /indexers/{{.Package}}/metrics

Get performance and processing metrics.

{{"`"}}{{"`"}}{{"`"}}bash
curl "http://localhost:8080/indexers/{{.Package}}/metrics"
{{"`"}}{{"`"}}{{"`"}}

### GET /health

Check API and indexer health status.

{{"`"}}{{"`"}}{{"`"}}bash
curl "http://localhost:8080/health"
{{"`"}}{{"`"}}{{"`"}}

### Swagger UI

For interactive API documentation, visit:
[http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)

See the [Code Generator Documentation](../../internal/codegen/README.md#api-integration-optional) for instructions on implementing the {{"`"}}Queryable{{"`"}} interface.

## Generated Files

- {{"`"}}indexer.go{{"`"}} - Main indexer implementation
- {{"`"}}models.go{{"`"}} - Event struct definitions
- {{"`"}}register.go{{"`"}} - Registry integration (for using with ChainIndexor binary)
- {{"`"}}migrations/migrations.go{{"`"}} - Database schema and migrations

## Customization

This indexer was auto-generated. To add custom logic:

1. Create a new file (e.g., {{"`"}}indexer_custom.go{{"`"}})
2. Add methods to the {{"`"}}{{.Name}}Indexer{{"`"}} struct
3. The generated files won't be overwritten unless you regenerate with {{"`"}}--force{{"`"}}

## Regeneration

To regenerate this indexer after config changes:

{{"`"}}{{"`"}}{{"`"}}bash
indexer-gen \
  --name "{{.Name}}" \
{{- range .Events}}
  --event "{{.Raw}}" \
{{- end}}
  --output ./indexers/{{.Package}} \
  --force
{{"`"}}{{"`"}}{{"`"}}
